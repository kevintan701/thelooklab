<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LookLab - Messages</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        /* Custom scrollbar for message areas */
        .messages-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .messages-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .messages-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(203, 213, 225, 0.8);
            border-radius: 20px;
        }

        /* Message bubble animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-bubble {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* Typing indicator animation */
        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
        }
        
        .typing-dot {
            animation: bounce 1.4s infinite ease-in-out;
        }
        
        /* Full-height layout fixes */
        html, body {
            height: 100% !important;
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
        }
        
        .page-container {
            height: 100% !important;
            width: 100% !important;
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
        }
        
        .messages-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            height: calc(100% - 70px); /* Account for header */
        }
        
        .conversation-list {
            width: 320px;
            overflow-y: auto;
            border-right: 1px solid #e5e7eb;
            background-color: white;
            height: 100%;
            flex-shrink: 0;
        }
        
        .conversation-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            height: 100%;
            overflow: hidden;
            background-color: #f9fafb;
            position: relative;
        }
        
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            min-height: 200px;
            background-color: #f9fafb;
            height: calc(100% - 80px);
        }
        
        .message-input-container {
            padding: 1rem;
            background-color: white;
            border-top: 1px solid #e5e7eb;
            z-index: 10;
            position: relative;
        }
        
        /* Fix for iframe embedded view */
        body.in-iframe {
            position: fixed !important;
            overflow: hidden !important;
        }
        
        body.in-iframe .page-container {
            position: fixed !important;
            overflow: hidden !important;
        }
        
        body.in-iframe .messages-content {
            height: calc(100% - 70px) !important;
        }
        
        body.in-iframe .conversation-container {
            height: 100% !important;
        }
        
        body.in-iframe .messages-area {
            height: calc(100% - 80px) !important;
        }
        
        body.in-iframe .conversation-list {
            height: 100% !important;
        }
        
        /* Improved message styling */
        .message-bubble {
            margin-bottom: 1rem;
            max-width: 80%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
        }
        
        .user-message-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 1rem;
        }
        
        .contact-message-container {
            display: flex;
            margin-bottom: 1rem;
        }
        
        .user-message {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 1rem 1rem 0.25rem 1rem;
        }
        
        .contact-message {
            background-color: white;
            color: #1a202c;
            padding: 0.75rem 1rem;
            border-radius: 1rem 1rem 1rem 0.25rem;
            border: 1px solid #e2e8f0;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }
        
        .contact-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin-left: 0.75rem;
            flex-shrink: 0;
        }
        
        /* Fix for Firefox */
        @-moz-document url-prefix() {
            .page-container {
                height: 100%;
            }
            
            .messages-content {
                height: calc(100% - 70px);
            }
            
            .conversation-container {
                height: 100%;
            }
            
            .messages-area {
                height: calc(100% - 80px);
            }
        }
        
        /* Premium styling for buttons */
        .btn-premium {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
            border: none;
        }
        
        .btn-premium:hover {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.25);
            transform: translateY(-1px);
        }
        
        .btn-premium:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2);
        }
        
        /* Premium circular send button */
        .send-button {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            width: 46px;
            height: 46px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }
        
        .send-button:hover {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            box-shadow: 0 6px 16px rgba(139, 92, 246, 0.3);
            transform: translateY(-1px) scale(1.05);
        }
        
        .send-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.25);
        }
        
        /* Subtle ripple effect on send button */
        .send-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            transition: transform 0.5s, opacity 0.3s;
        }
        
        .send-button:active::after {
            transform: translate(-50%, -50%) scale(1.5);
            opacity: 0;
        }
        
        /* Premium styling for input fields */
        .input-field-premium {
            border: 1px solid #e2e8f0;
            border-radius: 9999px;
            padding: 0.75rem 1rem;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        
        .input-field-premium:focus {
            border-color: #a5b4fc;
            box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.1);
            outline: none;
        }
        
        /* Tab styling */
        .tab-button {
            position: relative;
            overflow: hidden;
        }
        
        .tab-button.active {
            color: #6366f1 !important;
            border-color: #6366f1 !important;
        }
    </style>
</head>
<body class="bg-gray-50 flex flex-col h-full">
    <div class="page-container">
        <!-- Header -->
        <div class="px-6 py-4 bg-white border-b border-gray-200 shadow-sm">
            <h1 class="text-2xl font-bold text-gray-800">Messages</h1>
            <p class="text-gray-600 text-sm">Connect with designers and partners</p>
        </div>

        <!-- Main content -->
        <div class="messages-content bg-white">
            <!-- Left sidebar - Conversations list -->
            <div class="w-1/3 border-r border-gray-200 overflow-hidden flex flex-col">
                <!-- Search -->
                <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
                    <div class="relative">
                        <input type="text" placeholder="Search messages..." class="input-field w-full pr-10 py-2 bg-white rounded-full border-gray-200 shadow-sm">
                        <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                
                <!-- Tabs -->
                <div class="flex border-b border-gray-200 bg-white">
                    <button id="chat-tab" class="tab-button flex-1 py-3 text-sm font-medium text-indigo-600 border-b-2 border-indigo-600 transition-colors">
                        Chat
                    </button>
                    <button id="contacts-tab" class="tab-button flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 transition-colors">
                        Contacts
                        <span class="inline-flex items-center justify-center ml-1 w-5 h-5 text-xs font-bold rounded-full bg-indigo-100 text-indigo-800">3</span>
                    </button>
                </div>
                
                <!-- Conversation list -->
                <div id="conversations-container" class="overflow-y-auto messages-scrollbar flex-grow">
                    <!-- Conversation 1 - Active -->
                    <div class="conversation-item flex items-center p-4 border-b border-gray-100 bg-blue-50 hover:bg-blue-100 transition-colors cursor-pointer" data-status="read" data-contact="elena">
                        <div class="relative flex-shrink-0">
                            <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Elena Rodriguez" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Elena+Rodriguez&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="ml-4 flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <h3 class="text-sm font-semibold text-gray-900 truncate">Elena Rodriguez</h3>
                                <span class="text-xs font-medium text-blue-600 flex-shrink-0 ml-1">10:42 AM</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1 truncate">Yes, I'd be happy to discuss the details of our collaboration...</p>
                        </div>
                    </div>
                    
                    <!-- Conversation 2 - Unread -->
                    <div class="conversation-item flex items-center p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-status="unread" data-unread="2" data-contact="marcus">
                        <div class="relative flex-shrink-0">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Marcus Chen" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Marcus+Chen&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-gray-400 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="ml-4 flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <h3 class="text-sm font-semibold text-gray-900 truncate">Marcus Chen</h3>
                                <span class="text-xs text-gray-500 flex-shrink-0 ml-1">Yesterday</span>
                            </div>
                            <div class="flex justify-between items-center mt-1">
                                <p class="text-xs text-gray-600 truncate font-medium">I've just released my new collection. Would you be interested...</p>
                                <div class="unread-badge w-5 h-5 rounded-full bg-blue-600 flex items-center justify-center shadow-sm flex-shrink-0 ml-1">
                                    <span class="text-xs text-white font-medium">2</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Conversation 3 -->
                    <div class="conversation-item flex items-center p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-status="read" data-contact="sophia">
                        <div class="relative flex-shrink-0">
                            <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Sophia Ward" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Sophia+Ward&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="ml-4 flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <h3 class="text-sm font-semibold text-gray-900 truncate">Sophia Ward</h3>
                                <span class="text-xs text-gray-500 flex-shrink-0 ml-1">Wed</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1 truncate">Thank you for your order! I'll make sure it's shipped by tomorrow.</p>
                        </div>
                    </div>
                    
                    <!-- Conversation 4 -->
                    <div class="conversation-item flex items-center p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-status="read" data-contact="james">
                        <div class="relative flex-shrink-0">
                            <img src="https://images.unsplash.com/photo-1568602471122-7832951cc4c5?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="James Wilson" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=James+Wilson&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-gray-400 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="ml-4 flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <h3 class="text-sm font-semibold text-gray-900 truncate">James Wilson</h3>
                                <span class="text-xs text-gray-500 flex-shrink-0 ml-1">Mon</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1 truncate">Let me know if you'd like to schedule a virtual meeting to discuss...</p>
                        </div>
                    </div>
                    
                    <!-- Conversation 5 -->
                    <div class="conversation-item flex items-center p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-status="archived" data-contact="aiko">
                        <div class="relative flex-shrink-0">
                            <img src="https://images.unsplash.com/photo-1580489944761-15a19d654956?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Aiko Tanaka" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Aiko+Tanaka&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-gray-400 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="ml-4 flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <h3 class="text-sm font-semibold text-gray-900 truncate">Aiko Tanaka</h3>
                                <span class="text-xs text-gray-500 flex-shrink-0 ml-1">May 28</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1 truncate">I appreciate your interest in my avant-garde designs...</p>
                        </div>
                    </div>
                    
                    <!-- Conversation 6 -->
                    <div class="conversation-item flex items-center p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-status="read" data-contact="support">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center shadow-sm border border-white">
                                <img src="../img/looklab-logo-mini.svg" alt="LookLab Support" class="w-6 h-6" onerror="this.src='https://ui-avatars.com/api/?name=LB&background=4F46E5&color=fff'; this.onerror=null;">
                            </div>
                            <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                        </div>
                        <div class="ml-4 flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <h3 class="text-sm font-semibold text-gray-900 truncate">LookLab Support</h3>
                                <span class="text-xs text-gray-500 flex-shrink-0 ml-1">May 22</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1 truncate">Is there anything we can help you with today?</p>
                        </div>
                    </div>
                </div>

                <!-- Contacts Container -->
                <div id="contacts-container" class="overflow-y-auto messages-scrollbar flex-grow hidden">
                    <!-- Contacts/Connections Management Section -->
                    <div class="p-3 bg-indigo-50 border-b border-indigo-100">
                        <h3 class="text-sm font-semibold text-gray-900 mb-1">Connection Requests</h3>
                        <p class="text-xs text-gray-600">Manage your connection requests with designers and partners</p>
                    </div>

                    <!-- Connection Request 1 - Pending -->
                    <div class="connection-request-item p-4 border-b border-gray-100 hover:bg-gray-50">
                        <div class="flex items-center mb-3">
                            <div class="relative flex-shrink-0">
                                <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                    alt="David Kim" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white"
                                    onerror="this.src='https://ui-avatars.com/api/?name=David+Kim&background=4F46E5&color=fff'; this.onerror=null;">
                            </div>
                            <div class="ml-4 flex-1 min-w-0">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-sm font-semibold text-gray-900">David Kim</h3>
                                    <span class="text-xs text-gray-500">2 days ago</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">I'm a fashion designer specializing in streetwear and sustainable fashion.</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-indigo-50 rounded-lg">
                            <div class="flex items-center">
                                <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-yellow-100 text-yellow-800 mr-2">
                                    <i class="fas fa-clock text-xs"></i>
                                </span>
                                <span class="text-xs font-medium text-gray-700">Pending Request</span>
                            </div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 text-xs font-medium text-white bg-indigo-600 rounded-full hover:bg-indigo-700 transition-colors">
                                    Accept
                                </button>
                                <button class="px-3 py-1 text-xs font-medium text-gray-700 bg-gray-200 rounded-full hover:bg-gray-300 transition-colors">
                                    Decline
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Connection Request 2 - Accepted -->
                    <div class="connection-request-item p-4 border-b border-gray-100 hover:bg-gray-50">
                        <div class="flex items-center mb-3">
                            <div class="relative flex-shrink-0">
                                <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                    alt="Emily Johnson" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white"
                                    onerror="this.src='https://ui-avatars.com/api/?name=Emily+Johnson&background=4F46E5&color=fff'; this.onerror=null;">
                            </div>
                            <div class="ml-4 flex-1 min-w-0">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-sm font-semibold text-gray-900">Emily Johnson</h3>
                                    <span class="text-xs text-gray-500">1 week ago</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Fashion blogger and influencer looking to connect with innovative designers.</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-green-50 rounded-lg">
                            <div class="flex items-center">
                                <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-green-100 text-green-800 mr-2">
                                    <i class="fas fa-check text-xs"></i>
                                </span>
                                <span class="text-xs font-medium text-gray-700">Request Accepted</span>
                            </div>
                            <button class="px-3 py-1 text-xs font-medium text-indigo-600 bg-indigo-100 rounded-full hover:bg-indigo-200 transition-colors">
                                Message
                            </button>
                        </div>
                    </div>
                    
                    <!-- Connection Request 3 - Incoming -->
                    <div class="connection-request-item p-4 border-b border-gray-100 hover:bg-gray-50">
                        <div class="flex items-center mb-3">
                            <div class="relative flex-shrink-0">
                                <img src="https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                    alt="Michael Roberts" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white"
                                    onerror="this.src='https://ui-avatars.com/api/?name=Michael+Roberts&background=4F46E5&color=fff'; this.onerror=null;">
                            </div>
                            <div class="ml-4 flex-1 min-w-0">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-sm font-semibold text-gray-900">Michael Roberts</h3>
                                    <span class="text-xs text-gray-500">Just now</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Retail buyer for luxury department store. Looking for emerging talent.</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-blue-50 rounded-lg">
                            <div class="flex items-center">
                                <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 text-blue-800 mr-2">
                                    <i class="fas fa-arrow-down text-xs"></i>
                                </span>
                                <span class="text-xs font-medium text-gray-700">Incoming Request</span>
                            </div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 text-xs font-medium text-white bg-indigo-600 rounded-full hover:bg-indigo-700 transition-colors">
                                    Accept
                                </button>
                                <button class="px-3 py-1 text-xs font-medium text-gray-700 bg-gray-200 rounded-full hover:bg-gray-300 transition-colors">
                                    Decline
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Connected Contacts Section -->
                    <div class="p-3 bg-indigo-50 border-b border-indigo-100 mt-4">
                        <h3 class="text-sm font-semibold text-gray-900 mb-1">My Connections</h3>
                        <p class="text-xs text-gray-600">Your connected designers and partners</p>
                    </div>

                    <!-- Contact 1 -->
                    <div class="contact-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer">
                        <div class="flex items-center">
                            <div class="relative flex-shrink-0">
                                <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                    alt="Elena Rodriguez" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white">
                                <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                            </div>
                            <div class="ml-4 flex-1 min-w-0">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-sm font-semibold text-gray-900">Elena Rodriguez</h3>
                                    <div class="flex items-center space-x-1">
                                        <span class="px-2 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full">Designer</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Sustainable fashion designer • Connected 2 months ago</p>
                            </div>
                        </div>
                    </div>

                    <!-- Contact 2 -->
                    <div class="contact-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer">
                        <div class="flex items-center">
                            <div class="relative flex-shrink-0">
                                <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                    alt="Marcus Chen" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white">
                                <div class="absolute bottom-0 right-0 w-3 h-3 bg-gray-400 rounded-full border-2 border-white"></div>
                            </div>
                            <div class="ml-4 flex-1 min-w-0">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-sm font-semibold text-gray-900">Marcus Chen</h3>
                                    <div class="flex items-center space-x-1">
                                        <span class="px-2 py-1 text-xs font-medium text-blue-800 bg-blue-100 rounded-full">Partner</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Retail partner • Connected 3 weeks ago</p>
                            </div>
                        </div>
                    </div>

                    <!-- Contact 3 -->
                    <div class="contact-item p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer">
                        <div class="flex items-center">
                            <div class="relative flex-shrink-0">
                                <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                    alt="Sophia Ward" class="w-12 h-12 rounded-full object-cover shadow-sm border border-white">
                                <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                            </div>
                            <div class="ml-4 flex-1 min-w-0">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-sm font-semibold text-gray-900">Sophia Ward</h3>
                                    <div class="flex items-center space-x-1">
                                        <span class="px-2 py-1 text-xs font-medium text-purple-800 bg-purple-100 rounded-full">Customer</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">Premium customer • Connected 2 months ago</p>
                            </div>
                        </div>
                    </div>

                    <!-- Add Connection Button -->
                    <div class="p-4">
                        <button class="w-full py-2 px-4 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 font-medium rounded-lg transition-colors flex items-center justify-center">
                            <i class="fas fa-user-plus mr-2"></i>
                            Find New Connections
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Right side - Conversation -->
            <div class="w-2/3 conversation-container bg-gradient-to-b from-blue-50 to-gray-50">
                <!-- Conversation header -->
                <div class="px-6 py-4 bg-white border-b border-gray-200 flex items-center shadow-sm">
                    <div class="relative">
                        <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                            alt="Elena Rodriguez" class="w-10 h-10 rounded-full object-cover shadow-sm border border-white">
                        <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-white"></div>
                    </div>
                    <div class="ml-3">
                        <h2 class="text-sm font-semibold text-gray-900">Elena Rodriguez</h2>
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-green-500 rounded-full mr-1"></div>
                            <span class="text-xs text-gray-500">Online</span>
                        </div>
                    </div>
                    <div class="ml-auto flex space-x-1">
                        <button class="p-2 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-indigo-50 transition-all duration-300" title="Voice call">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="p-2 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-indigo-50 transition-all duration-300" title="Video call">
                            <i class="fas fa-video"></i>
                        </button>
                        <button class="p-2 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-indigo-50 transition-all duration-300" title="View profile">
                            <i class="fas fa-user"></i>
                        </button>
                        <button class="p-2 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-indigo-50 transition-all duration-300" title="More options">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Connection Request Details Container -->
                <div id="request-details-container" class="flex-1 flex flex-col hidden">
                    <div class="flex-1 flex flex-col items-center justify-center p-8">
                        <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6 text-center">
                            <!-- Profile section -->
                            <div class="mb-6">
                                <div class="relative mx-auto w-24 h-24 mb-4">
                                    <img id="request-detail-avatar" src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80" 
                                        alt="David Kim" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-md"
                                        onerror="this.src='https://ui-avatars.com/api/?name=David+Kim&background=4F46E5&color=fff&size=96'; this.onerror=null;">
                                    <div class="absolute bottom-0 right-0 w-6 h-6 bg-green-500 rounded-full border-4 border-white"></div>
                                </div>
                                <h2 id="request-detail-name" class="text-xl font-bold text-gray-900">David Kim</h2>
                                <p id="request-detail-title" class="text-sm text-gray-600">Fashion Designer</p>
                            </div>
                            
                            <!-- Request status -->
                            <div class="mb-6">
                                <div id="request-status-badge" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                                    <span class="mr-1"><i class="fas fa-clock"></i></span>
                                    Pending Connection Request
                                </div>
                                <p class="text-sm text-gray-500 mt-2" id="request-detail-date">Sent 2 days ago</p>
                            </div>
                            
                            <!-- Request message -->
                            <div class="mb-6 bg-gray-50 rounded-lg p-4 text-left">
                                <h3 class="text-sm font-medium text-gray-900 mb-2">Request Message:</h3>
                                <p id="request-detail-message" class="text-sm text-gray-700">
                                    "Hi Sarah, I'm a fashion designer specializing in streetwear and sustainable fashion. I came across your profile and would love to connect to discuss potential collaboration opportunities."
                                </p>
                            </div>
                            
                            <!-- Bio/Profile summary -->
                            <div class="mb-6 text-left">
                                <h3 class="text-sm font-medium text-gray-900 mb-2">About:</h3>
                                <p id="request-detail-bio" class="text-sm text-gray-700">
                                    Fashion designer with 5+ years of experience, specializing in sustainable streetwear. Based in Seoul with a studio in New York. Featured in Vogue and Elle magazines.
                                </p>
                            </div>
                            
                            <!-- Action buttons -->
                            <div class="flex space-x-3">
                                <button id="accept-request-btn" class="flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors shadow-sm">
                                    Accept Request
                                </button>
                                <button id="decline-request-btn" class="flex-1 py-2 px-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors">
                                    Decline
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Messages area -->
                <div class="messages-area p-6 messages-scrollbar">
                    <!-- Elena Rodriguez Chat -->
                    <div id="chat-elena" class="chat-content active">
                        <!-- Date divider -->
                        <div class="flex items-center justify-center mb-6">
                            <div class="border-t border-gray-200 flex-grow"></div>
                            <div class="text-xs font-medium text-gray-500 bg-white px-3 mx-2 shadow-sm rounded-full py-1">Today</div>
                            <div class="border-t border-gray-200 flex-grow"></div>
                        </div>
                        
                        <!-- Message - Received -->
                        <div class="flex items-end mb-5">
                            <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Elena Rodriguez" class="w-8 h-8 rounded-full object-cover shadow-sm mr-2 border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Elena+Rodriguez&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="max-w-xs bg-white rounded-2xl rounded-bl-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm text-gray-800">Hi Sarah, thanks for reaching out! I'd love to discuss potential collaboration opportunities for my sustainable collection.</p>
                            </div>
                            <span class="text-xs text-gray-500 ml-2">9:32 AM</span>
                        </div>
                        
                        <!-- Message - Sent -->
                        <div class="flex items-end justify-end mb-5">
                            <span class="text-xs text-gray-500 mr-2">9:45 AM</span>
                            <div class="max-w-xs bg-blue-600 text-white rounded-2xl rounded-br-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm">Great to hear from you, Elena! I was really impressed with your sustainable denim pieces. Our customers have been asking for more eco-conscious options.</p>
                            </div>
                        </div>
                        
                        <!-- Message - Received -->
                        <div class="flex items-end mb-5">
                            <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Elena Rodriguez" class="w-8 h-8 rounded-full object-cover shadow-sm mr-2 border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Elena+Rodriguez&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="max-w-xs bg-white rounded-2xl rounded-bl-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm text-gray-800">I'm glad to hear that! My sustainable denim collection uses recycled materials and eco-friendly dyes. I could prepare a small selection specifically for your store.</p>
                            </div>
                            <span class="text-xs text-gray-500 ml-2">10:02 AM</span>
                        </div>
                        
                        <!-- Message - Received with attachment -->
                        <div class="flex items-end mb-5">
                            <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Elena Rodriguez" class="w-8 h-8 rounded-full object-cover shadow-sm mr-2 border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Elena+Rodriguez&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="max-w-xs bg-white rounded-2xl rounded-bl-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm text-gray-800 mb-3">Here's a preview of some pieces from the collection:</p>
                                <div class="rounded-xl overflow-hidden mb-2 shadow-sm">
                                    <img src="https://images.unsplash.com/photo-1542272604-787c3835535d?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80" 
                                        alt="Sustainable Denim Collection" class="w-full h-auto"
                                        onerror="this.src='https://placehold.co/300x200?text=Denim+Collection'; this.onerror=null;">
                                </div>
                                <div class="flex items-center p-2 bg-gray-100 rounded-lg">
                                    <i class="far fa-file-pdf text-red-500 mr-2"></i>
                                    <div class="flex-grow">
                                        <div class="text-xs font-medium text-gray-900">Sustainable Denim Lookbook.pdf</div>
                                        <div class="text-xs text-gray-500">2.4 MB</div>
                                    </div>
                                    <button class="text-blue-600 hover:text-blue-800" title="Download attachment">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                            <span class="text-xs text-gray-500 ml-2">10:15 AM</span>
                        </div>
                        
                        <!-- Message - Sent -->
                        <div class="flex items-end justify-end mb-3">
                            <span class="text-xs text-gray-500 mr-2">10:30 AM</span>
                            <div class="max-w-xs bg-blue-600 text-white rounded-2xl rounded-br-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm">These look amazing! I especially love the jacket and high-waisted jeans. Our customers would definitely be interested in these styles.</p>
                            </div>
                        </div>
                        
                        <!-- Message - Sent -->
                        <div class="flex items-end justify-end mb-5">
                            <span class="text-xs text-gray-500 mr-2">10:32 AM</span>
                            <div class="max-w-xs bg-blue-600 text-white rounded-2xl rounded-br-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm">Would you be able to discuss pricing and minimum order quantities? Also, what's your typical production timeline?</p>
                            </div>
                        </div>
                        
                        <!-- Message - Received -->
                        <div class="flex items-end mb-5">
                            <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Elena Rodriguez" class="w-8 h-8 rounded-full object-cover shadow-sm mr-2 border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Elena+Rodriguez&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="max-w-xs bg-white rounded-2xl rounded-bl-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm text-gray-800">Yes, I'd be happy to discuss the details of our collaboration. Would you prefer to schedule a video call to go through everything? I'm available tomorrow afternoon.</p>
                            </div>
                            <span class="text-xs text-gray-500 ml-2">10:42 AM</span>
                        </div>
                        
                        <!-- Typing indicator -->
                        <div class="flex items-end ml-10">
                            <div class="bg-white rounded-full py-2 px-3 shadow-sm">
                                <div class="flex space-x-1">
                                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot" style="animation-delay: 0.2s"></div>
                                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot" style="animation-delay: 0.4s"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Marcus Chen Chat -->
                    <div id="chat-marcus" class="chat-content hidden">
                        <!-- Date divider -->
                        <div class="flex items-center justify-center mb-6">
                            <div class="border-t border-gray-200 flex-grow"></div>
                            <div class="text-xs font-medium text-gray-500 bg-white px-3 mx-2 shadow-sm rounded-full py-1">Yesterday</div>
                            <div class="border-t border-gray-200 flex-grow"></div>
                        </div>
                        
                        <!-- Message - Received -->
                        <div class="flex items-end mb-5">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Marcus Chen" class="w-8 h-8 rounded-full object-cover shadow-sm mr-2 border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Marcus+Chen&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="max-w-xs bg-white rounded-2xl rounded-bl-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm text-gray-800">Hi Sarah! Excited to share my new Fall/Winter collection with you. It's called "Urban Essence" - focusing on sustainable minimalist designs with versatile pieces perfect for your store's clientele.</p>
                            </div>
                            <span class="text-xs text-gray-500 ml-2">3:15 PM</span>
                        </div>
                        
                        <!-- Message - Received with images -->
                        <div class="flex items-end mb-5">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Marcus Chen" class="w-8 h-8 rounded-full object-cover shadow-sm mr-2 border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Marcus+Chen&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="max-w-xs bg-white rounded-2xl rounded-bl-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm text-gray-800 mb-3">Here are some signature pieces from the collection. Each garment is crafted from eco-friendly materials, with a focus on longevity and timeless design:</p>
                                <div class="grid grid-cols-2 gap-2 mt-2">
                                    <img src="https://images.unsplash.com/photo-1489987707025-afc232f7ea0f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80" 
                                        alt="Urban collection jacket" class="rounded-lg w-full h-auto object-cover" />
                                    <img src="https://images.unsplash.com/photo-1434389677669-e08b4cac3105?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80" 
                                        alt="Urban collection shirt" class="rounded-lg w-full h-auto object-cover" />
                                </div>
                            </div>
                            <span class="text-xs text-gray-500 ml-2">3:20 PM</span>
                        </div>
                        
                        <!-- Message - Received with another image -->
                        <div class="flex items-end mb-5">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Marcus Chen" class="w-8 h-8 rounded-full object-cover shadow-sm mr-2 border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Marcus+Chen&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="max-w-xs bg-white rounded-2xl rounded-bl-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm text-gray-800 mb-3">Our outerwear pieces have been especially popular. This coat combines waterproof recycled polyester with a detachable inner layer for versatility:</p>
                                <img src="https://images.unsplash.com/photo-1591047139829-d91aecb6caea?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80" 
                                    alt="Urban collection coat" class="rounded-lg w-full h-auto object-cover" />
                                <p class="text-sm text-gray-800 mt-3">The entire collection will be available for wholesale next week, but I wanted to give you early access as one of our preferred retail partners.</p>
                            </div>
                            <span class="text-xs text-gray-500 ml-2">3:25 PM</span>
                        </div>
                        
                        <!-- Message - Sent - Unread by Marcus -->
                        <div class="flex items-end justify-end mb-3">
                            <span class="text-xs text-gray-500 mr-2">5:45 PM</span>
                            <div class="max-w-xs bg-blue-600 text-white rounded-2xl rounded-br-none py-2.5 px-4 shadow-sm message-bubble relative">
                                <p class="text-sm">These designs look fantastic, Marcus! I'm really impressed with the clean lines and versatile aesthetic. The sustainable materials align perfectly with what our customers have been asking for. Would you be available for a video call tomorrow to discuss pricing, minimum order quantities, and delivery timelines?</p>
                                <!-- Unread indicator -->
                                <span class="absolute -bottom-1 -right-1 w-3 h-3 bg-blue-500 rounded-full border-2 border-white"></span>
                            </div>
                        </div>
                        
                        <!-- Message - Sent - Unread by Marcus -->
                        <div class="flex items-end justify-end mb-5">
                            <span class="text-xs text-gray-500 mr-2">5:47 PM</span>
                            <div class="max-w-xs bg-blue-600 text-white rounded-2xl rounded-br-none py-2.5 px-4 shadow-sm message-bubble relative">
                                <p class="text-sm">I'm particularly interested in the outerwear pieces - they would be perfect for our fall campaign. Do you have a lookbook with the full collection you could share with me?</p>
                                <!-- Unread indicator -->
                                <span class="absolute -bottom-1 -right-1 w-3 h-3 bg-blue-500 rounded-full border-2 border-white"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Sophia Ward Chat -->
                    <div id="chat-sophia" class="chat-content hidden">
                        <!-- Date divider -->
                        <div class="flex items-center justify-center mb-6">
                            <div class="border-t border-gray-200 flex-grow"></div>
                            <div class="text-xs font-medium text-gray-500 bg-white px-3 mx-2 shadow-sm rounded-full py-1">Wednesday</div>
                            <div class="border-t border-gray-200 flex-grow"></div>
                        </div>
                        
                        <!-- Message - Sent -->
                        <div class="flex items-end justify-end mb-5">
                            <span class="text-xs text-gray-500 mr-2">11:20 AM</span>
                            <div class="max-w-xs bg-blue-600 text-white rounded-2xl rounded-br-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm">Hi Sophia, your order #LB8742 has been processed and is ready for shipping. Would you like us to proceed with the standard shipping option you selected?</p>
                            </div>
                        </div>
                        
                        <!-- Message - Received -->
                        <div class="flex items-end mb-5">
                            <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Sophia Ward" class="w-8 h-8 rounded-full object-cover shadow-sm mr-2 border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Sophia+Ward&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="max-w-xs bg-white rounded-2xl rounded-bl-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm text-gray-800">Yes, please proceed with the standard shipping. Thank you for the quick processing!</p>
                            </div>
                            <span class="text-xs text-gray-500 ml-2">1:30 PM</span>
                        </div>
                        
                        <!-- Message - Sent -->
                        <div class="flex items-end justify-end mb-5">
                            <span class="text-xs text-gray-500 mr-2">2:15 PM</span>
                            <div class="max-w-xs bg-blue-600 text-white rounded-2xl rounded-br-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm">Perfect! We'll get it shipped right away. You should receive a tracking number by end of day.</p>
                            </div>
                        </div>
                        
                        <!-- Message - Received -->
                        <div class="flex items-end mb-5">
                            <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                                alt="Sophia Ward" class="w-8 h-8 rounded-full object-cover shadow-sm mr-2 border border-white"
                                onerror="this.src='https://ui-avatars.com/api/?name=Sophia+Ward&background=4F46E5&color=fff'; this.onerror=null;">
                            <div class="max-w-xs bg-white rounded-2xl rounded-bl-none py-2.5 px-4 shadow-sm message-bubble">
                                <p class="text-sm text-gray-800">Thank you for your order! I'll make sure it's shipped by tomorrow.</p>
                            </div>
                            <span class="text-xs text-gray-500 ml-2">4:45 PM</span>
                        </div>
                    </div>
                </div>
                
                <!-- Message input -->
                <div class="px-4 py-3 bg-white border-t border-gray-200">
                    <div class="flex items-center">
                        <button class="p-2 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-indigo-50 transition-all duration-300 mr-1" title="Attach file">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <div class="flex-1 relative">
                            <input type="text" placeholder="Type a message..." id="message-input" class="input-field-premium py-3">
                            <button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-indigo-600 transition-all duration-300" title="Add emoji">
                                <i class="far fa-smile"></i>
                            </button>
                        </div>
                        <button id="send-message-btn" class="send-button ml-3" title="Send message">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we're in an iframe
            const isInIframe = window.self !== window.top;
            if (isInIframe) {
                // Add specific styles for iframe mode
                document.body.classList.add('in-iframe');
                
                // Send message to parent that we're ready
                try {
                    window.parent.postMessage({ type: 'CHAT_FRAME_READY' }, '*');
                } catch (e) {
                    console.error('Error sending ready message:', e);
                }
            }
            
            // Listen for messages from parent iframe
            window.addEventListener('message', function(event) {
                // Handle resize message
                if (event.data && event.data.type === 'PARENT_RESIZE') {
                    const { height, width } = event.data;
                    console.log('Received resize from parent:', { height, width });
                    
                    const pageContainer = document.querySelector('.page-container');
                    const messagesContent = document.querySelector('.messages-content');
                    const conversationContainer = document.querySelector('.conversation-container');
                    const messagesArea = document.querySelector('.messages-area');
                    const conversationList = document.querySelector('.conversation-list');
                    
                    if (pageContainer) {
                        // Adjust to fit the parent iframe dimensions
                        pageContainer.style.height = `${height}px`;
                        pageContainer.style.width = `${width}px`;
                        
                        // Adjust child containers
                        if (messagesContent) {
                            messagesContent.style.height = `${height - 70}px`;
                        }
                        
                        if (conversationContainer) {
                            conversationContainer.style.height = '100%';
                        }
                        
                        if (messagesArea) {
                            messagesArea.style.height = `${height - 150}px`;
                        }
                        
                        if (conversationList) {
                            conversationList.style.height = `${height - 70}px`;
                        }
                        
                        // Scroll to the bottom of messages
                        scrollToLatestMessage();
                    }
                }
            });
            
            // Function to adjust layout
            function adjustLayout() {
                const windowHeight = window.innerHeight;
                const windowWidth = window.innerWidth;
                
                const pageContainer = document.querySelector('.page-container');
                const messagesContent = document.querySelector('.messages-content');
                const conversationContainer = document.querySelector('.conversation-container');
                const messagesArea = document.querySelector('.messages-area');
                const conversationList = document.querySelector('.conversation-list');
                
                if (pageContainer) {
                    pageContainer.style.height = '100%';
                    pageContainer.style.width = '100%';
                    
                    if (messagesContent) {
                        messagesContent.style.height = 'calc(100% - 70px)';
                        
                        if (conversationContainer) {
                            conversationContainer.style.height = '100%';
                            
                            if (messagesArea) {
                                messagesArea.style.height = 'calc(100% - 80px)';
                            }
                        }
                        
                        if (conversationList) {
                            conversationList.style.height = '100%';
                        }
                    }
                }
                
                // Scroll to the bottom of messages
                scrollToLatestMessage();
                
                // Use ResizeObserver to track size changes if available
                if (window.ResizeObserver) {
                    const resizeObserver = new ResizeObserver(entries => {
                        for (let entry of entries) {
                            if (entry.target === messagesArea) {
                                scrollToLatestMessage();
                            }
                        }
                    });
                    
                    if (messagesArea) {
                        resizeObserver.observe(messagesArea);
                    }
                }
            }
            
            // Function to scroll to latest message
            function scrollToLatestMessage() {
                const messagesArea = document.querySelector('.messages-area');
                if (messagesArea) {
                    messagesArea.scrollTop = messagesArea.scrollHeight;
                }
            }
            
            // Initial layout adjustment
            adjustLayout();
            
            // Handle window resize
            window.addEventListener('resize', adjustLayout);
            
            // Add click handler for message input focus
            const messageInput = document.querySelector('.message-input');
            const sendButton = document.querySelector('.send-button');
            
            if (messageInput && sendButton) {
                sendButton.addEventListener('click', function() {
                    scrollToLatestMessage();
                });
                
                messageInput.addEventListener('focus', function() {
                    // Small delay to let keyboard appear on mobile
                    setTimeout(scrollToLatestMessage, 300);
                });
            }

            // Connection and Contacts Feature Functionality
            function initConnectionRequestFeature() {
                // Get tab buttons
                const chatTab = document.getElementById('chat-tab');
                const contactsTab = document.getElementById('contacts-tab');
                
                // Get content containers
                const conversationsContainer = document.getElementById('conversations-container');
                const contactsContainer = document.getElementById('contacts-container');
                
                // Get conversation content areas
                const messagesArea = document.querySelector('.messages-area');
                const requestDetailsContainer = document.getElementById('request-details-container');
                
                // Tab switching functionality
                function activateTab(activeTab) {
                    // Reset all tabs
                    [chatTab, contactsTab].forEach(tab => {
                        tab.classList.remove('text-indigo-600', 'border-indigo-600', 'border-b-2');
                        tab.classList.add('text-gray-500');
                    });
                    
                    // Activate selected tab
                    activeTab.classList.remove('text-gray-500');
                    activeTab.classList.add('text-indigo-600', 'border-indigo-600', 'border-b-2');
                }
                
                // Handle tab clicks
                if (chatTab) {
                    chatTab.addEventListener('click', function() {
                        activateTab(chatTab);
                        // Show conversations, hide contacts
                        conversationsContainer.classList.remove('hidden');
                        contactsContainer.classList.add('hidden');
                        
                        // Hide any placeholder that might be showing
                        const placeholder = document.getElementById('request-placeholder');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                        
                        // Reset conversation area to default view if in request details view
                        requestDetailsContainer.classList.add('hidden');
                        messagesArea.classList.remove('hidden');
                        
                        // Find the active conversation or default to the first one
                        const activeConversation = document.querySelector('.conversation-item.bg-blue-50') || 
                                                  document.querySelector('.conversation-item');
                        
                        if (activeConversation) {
                            // Get the contact's data
                            const contactName = activeConversation.querySelector('h3').textContent;
                            const isOnline = activeConversation.querySelector('.absolute.bottom-0.right-0.w-3.h-3.bg-green-500') !== null;
                            const contactImg = activeConversation.querySelector('img').src;
                            const contactId = activeConversation.getAttribute('data-contact');
                            
                            // Update the conversation header with synchronized data
                            updateConversationHeader(contactName, isOnline, contactImg);
                            
                            // Show the appropriate chat content
                            const chatContents = document.querySelectorAll('.chat-content');
                            chatContents.forEach(chat => {
                                chat.classList.add('hidden');
                                chat.classList.remove('active');
                            });
                            
                            const targetChat = document.getElementById(`chat-${contactId}`);
                            if (targetChat) {
                                targetChat.classList.remove('hidden');
                                targetChat.classList.add('active');
                                
                                // Scroll to the latest message
                                scrollToLatestMessage();
                                
                                // Focus on the message input
                                const messageInput = document.getElementById('message-input');
                                if (messageInput) {
                                    setTimeout(() => {
                                        messageInput.focus();
                                    }, 100);
                                }
                            }
                        } else {
                            // Default header if no conversation is active
                            updateConversationHeader('Chat', false);
                        }
                    });
                }
                
                if (contactsTab) {
                    contactsTab.addEventListener('click', function() {
                        activateTab(contactsTab);
                        // Show contacts, hide conversations
                        conversationsContainer.classList.add('hidden');
                        contactsContainer.classList.remove('hidden');
                        
                        // If no request is selected yet, show empty state in conversation area
                        if (messagesArea.classList.contains('hidden')) {
                            // Already showing a request detail, leave it
                        } else {
                            // Update header to show select a contact message
                            updateConversationHeader('Contacts', false);
                            // Hide messages and show placeholder
                            messagesArea.classList.add('hidden');
                            requestDetailsContainer.classList.add('hidden');
                            
                            // Create and show a placeholder message
                            const placeholderEl = document.createElement('div');
                            placeholderEl.id = 'request-placeholder';
                            placeholderEl.className = 'flex-1 flex flex-col items-center justify-center p-8 text-center text-gray-500';
                            placeholderEl.innerHTML = `
                                <div class="mb-4 w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center">
                                    <i class="fas fa-user-plus text-2xl text-gray-400"></i>
                                </div>
                                <h3 class="text-lg font-medium mb-2">Contacts & Connections</h3>
                                <p class="text-sm max-w-md">Select a contact or connection request from the list to view details and respond.</p>
                            `;
                            
                            // Add placeholder to container
                            const container = document.querySelector('.conversation-container');
                            if (container && !document.getElementById('request-placeholder')) {
                                container.appendChild(placeholderEl);
                            }
                        }
                    });
                }
                
                // Function to update the conversation header
                function updateConversationHeader(name, isOnline, imgSrc) {
                    const header = document.querySelector('.conversation-container .px-6.py-4.bg-white');
                    if (header) {
                        if (isOnline === undefined) isOnline = false;
                        
                        // If no image source is provided, try to find it from the conversation list
                        if (!imgSrc && name !== 'Chat' && name !== 'Contacts') {
                            const conversationItems = document.querySelectorAll('.conversation-item');
                            conversationItems.forEach(item => {
                                const itemName = item.querySelector('h3')?.textContent;
                                if (itemName === name) {
                                    const img = item.querySelector('img');
                                    if (img) {
                                        imgSrc = img.src;
                                    }
                                }
                            });
                            
                            // If still no image, check contacts list
                            if (!imgSrc) {
                                const contactItems = document.querySelectorAll('.contact-item');
                                contactItems.forEach(item => {
                                    const itemName = item.querySelector('h3')?.textContent;
                                    if (itemName === name) {
                                        const img = item.querySelector('img');
                                        if (img) {
                                            imgSrc = img.src;
                                        }
                                    }
                                });
                            }
                        }
                        
                        // Use a default avatar or placeholder if no image is found
                        if (!imgSrc) {
                            imgSrc = `https://ui-avatars.com/api/?name=${name.replace(' ', '+')}&background=4F46E5&color=fff`;
                        }
                        
                        header.innerHTML = `
                            <div class="relative">
                                <img src="${imgSrc}" 
                                    alt="${name}" class="w-10 h-10 rounded-full object-cover shadow-sm border border-white"
                                    onerror="this.src='https://ui-avatars.com/api/?name=${name.replace(' ', '+')}&background=4F46E5&color=fff'; this.onerror=null;">
                                ${isOnline ? '<div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-white"></div>' : ''}
                            </div>
                            <div class="ml-3">
                                <h2 class="text-sm font-semibold text-gray-900">${name}</h2>
                                ${isOnline ? `
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-green-500 rounded-full mr-1"></div>
                                        <span class="text-xs text-gray-500">Online</span>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="ml-auto flex space-x-1">
                                ${isOnline ? `
                                    <button class="p-2 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-indigo-50 transition-all duration-300" title="Voice call">
                                        <i class="fas fa-phone"></i>
                                    </button>
                                    <button class="p-2 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-indigo-50 transition-all duration-300" title="Video call">
                                        <i class="fas fa-video"></i>
                                    </button>
                                ` : ''}
                                <button class="p-2 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-indigo-50 transition-all duration-300" title="View profile">
                                    <i class="fas fa-user"></i>
                                </button>
                                <button class="p-2 text-gray-500 hover:text-indigo-600 rounded-full hover:bg-indigo-50 transition-all duration-300" title="More options">
                                    <i class="fas fa-ellipsis-h"></i>
                                </button>
                            </div>
                        `;
                    }
                }
                
                // Handle connection request item clicks
                const connectionItems = document.querySelectorAll('.connection-request-item, .contact-item');
                connectionItems.forEach(item => {
                    item.addEventListener('click', function() {
                        // Get the contact details from the item
                        const nameEl = this.querySelector('h3');
                        const bioEl = this.querySelector('p');
                        const imgEl = this.querySelector('img');
                        
                        // Determine if this is a connection request or a contact
                        const isConnectionRequest = this.classList.contains('connection-request-item');
                        const statusEl = isConnectionRequest ? this.querySelector('.flex.items-center span:last-child') : null;
                        
                        // Hide any placeholder
                        const placeholder = document.getElementById('request-placeholder');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                        
                        if (isConnectionRequest) {
                            // For connection requests, show request details
                            messagesArea.classList.add('hidden');
                            requestDetailsContainer.classList.remove('hidden');
                            
                            // Update request details with this connection's info
                            const requestDetailName = document.getElementById('request-detail-name');
                            const requestDetailAvatar = document.getElementById('request-detail-avatar');
                            const requestStatusBadge = document.getElementById('request-status-badge');
                            
                            if (requestDetailName && nameEl) {
                                requestDetailName.textContent = nameEl.textContent;
                            }
                            
                            if (requestDetailAvatar && imgEl) {
                                requestDetailAvatar.src = imgEl.src;
                                requestDetailAvatar.alt = imgEl.alt;
                            }
                            
                            if (requestStatusBadge && statusEl) {
                                // Set appropriate status styling
                                requestStatusBadge.className = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium';
                                
                                // Extract the status from the status text
                                const statusText = statusEl.textContent.trim();
                                
                                if (statusText.includes('Pending')) {
                                    requestStatusBadge.classList.add('bg-yellow-100', 'text-yellow-800');
                                    requestStatusBadge.innerHTML = '<span class="mr-1"><i class="fas fa-clock"></i></span> Pending Connection Request';
                                } else if (statusText.includes('Accepted')) {
                                    requestStatusBadge.classList.add('bg-green-100', 'text-green-800');
                                    requestStatusBadge.innerHTML = '<span class="mr-1"><i class="fas fa-check"></i></span> Connection Accepted';
                                } else if (statusText.includes('Incoming')) {
                                    requestStatusBadge.classList.add('bg-blue-100', 'text-blue-800');
                                    requestStatusBadge.innerHTML = '<span class="mr-1"><i class="fas fa-arrow-down"></i></span> Incoming Connection Request';
                                }
                            }
                        } else {
                            // For regular contacts, update the active conversation in the conversations list
                            const contactName = nameEl.textContent;
                            const conversationItems = document.querySelectorAll('.conversation-item');
                            
                            conversationItems.forEach(conversation => {
                                const conversationNameEl = conversation.querySelector('h3');
                                if (conversationNameEl && conversationNameEl.textContent === contactName) {
                                    // Set this conversation as active for when we switch back to the Chat tab
                                    conversationItems.forEach(conv => {
                                        conv.classList.remove('bg-blue-50');
                                        conv.classList.remove('hover:bg-blue-100');
                                        conv.classList.add('hover:bg-gray-50');
                                    });
                                    conversation.classList.add('bg-blue-50');
                                    conversation.classList.add('hover:bg-blue-100');
                                    conversation.classList.remove('hover:bg-gray-50');
                                }
                            });
                            
                            // Switch to the Chat tab
                            chatTab.click();
                        }
                        
                        // Update header with the person's name
                        updateConversationHeader(nameEl ? nameEl.textContent : 'Contact');
                    });
                });
                
                // Handle accept/decline request buttons for connection requests
                const acceptButtons = document.querySelectorAll('.connection-request-item button:first-of-type');
                acceptButtons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        // Prevent the click from bubbling to the parent (request item)
                        e.stopPropagation();
                        
                        // Get the parent request item
                        const requestItem = this.closest('.connection-request-item');
                        if (requestItem) {
                            // Update the status display
                            const statusContainer = requestItem.querySelector('.flex.justify-between.items-center.p-2');
                            if (statusContainer) {
                                statusContainer.className = 'flex justify-between items-center p-2 bg-green-50 rounded-lg';
                                statusContainer.innerHTML = `
                                    <div class="flex items-center">
                                        <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-green-100 text-green-800 mr-2">
                                            <i class="fas fa-check text-xs"></i>
                                        </span>
                                        <span class="text-xs font-medium text-gray-700">Request Accepted</span>
                                    </div>
                                    <button class="px-3 py-1 text-xs font-medium text-indigo-600 bg-indigo-100 rounded-full hover:bg-indigo-200 transition-colors">
                                        Message
                                    </button>
                                `;
                                
                                // Update the request detail view if this is the selected request
                                const requestDetailName = document.getElementById('request-detail-name');
                                const nameEl = requestItem.querySelector('h3');
                                if (requestDetailName && nameEl && requestDetailName.textContent === nameEl.textContent) {
                                    const requestStatusBadge = document.getElementById('request-status-badge');
                                    if (requestStatusBadge) {
                                        requestStatusBadge.className = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800';
                                        requestStatusBadge.innerHTML = '<span class="mr-1"><i class="fas fa-check"></i></span> Connection Accepted';
                                    }
                                    
                                    // Update action buttons
                                    const actionButtonsContainer = document.querySelector('#request-details-container .flex.space-x-3');
                                    if (actionButtonsContainer) {
                                        actionButtonsContainer.innerHTML = `
                                            <button class="flex-1 py-2 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors shadow-sm">
                                                Send Message
                                            </button>
                                            <button class="py-2 px-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors">
                                                View Profile
                                            </button>
                                        `;
                                    }
                                }
                                
                                // Show a success toast notification
                                showToastNotification('Connection request accepted!', 'success');
                            }
                        }
                    });
                });
                
                const declineButtons = document.querySelectorAll('.connection-request-item button:last-of-type, #decline-request-btn');
                declineButtons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        // Prevent the click from bubbling to the parent
                        e.stopPropagation();
                        
                        // Show a confirmation dialog
                        if (confirm('Are you sure you want to decline this connection request?')) {
                            // Get the parent request item
                            const requestItem = this.closest('.connection-request-item');
                            if (requestItem) {
                                // For demo, fade out and remove the request
                                requestItem.style.opacity = '0.5';
                                requestItem.style.transition = 'opacity 0.5s ease';
                                
                                setTimeout(() => {
                                    requestItem.style.display = 'none';
                                    
                                    // If this was the selected request, reset the view
                                    if (requestDetailsContainer && !requestDetailsContainer.classList.contains('hidden')) {
                                        requestDetailsContainer.classList.add('hidden');
                                        // Show placeholder
                                        const placeholder = document.getElementById('request-placeholder');
                                        if (placeholder) {
                                            placeholder.style.display = 'flex';
                                        } else {
                                            // Create placeholder if it doesn't exist
                                            const container = document.querySelector('.conversation-container');
                                            if (container) {
                                                const placeholderEl = document.createElement('div');
                                                placeholderEl.id = 'request-placeholder';
                                                placeholderEl.className = 'flex-1 flex flex-col items-center justify-center p-8 text-center text-gray-500';
                                                placeholderEl.innerHTML = `
                                                    <div class="mb-4 w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center">
                                                        <i class="fas fa-user-plus text-2xl text-gray-400"></i>
                                                    </div>
                                                    <h3 class="text-lg font-medium mb-2">Contacts & Connections</h3>
                                                    <p class="text-sm max-w-md">Select a contact or connection request from the list to view details and respond.</p>
                                                `;
                                                container.appendChild(placeholderEl);
                                            }
                                        }
                                    }
                                    
                                    // Update request count
                                    updateRequestCount();
                                    
                                    // Show a success toast notification
                                    showToastNotification('Connection request declined', 'info');
                                }, 500);
                            }
                        }
                    });
                });
                
                // Function to update the request count badge
                function updateRequestCount() {
                    const visibleRequests = Array.from(document.querySelectorAll('.connection-request-item')).filter(item => item.style.display !== 'none');
                    const requestCountBadge = contactsTab.querySelector('span');
                    if (requestCountBadge) {
                        requestCountBadge.textContent = visibleRequests.length;
                        
                        // Hide badge if no requests
                        if (visibleRequests.length === 0) {
                            requestCountBadge.classList.add('hidden');
                        } else {
                            requestCountBadge.classList.remove('hidden');
                        }
                    }
                }
                
                // Function to show toast notifications
                function showToastNotification(message, type = 'info') {
                    // Create toast element
                    const toast = document.createElement('div');
                    toast.className = 'fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg text-white text-sm font-medium transform transition-all duration-300 translate-y-20 opacity-0 z-50';
                    
                    // Set appropriate styling based on type
                    if (type === 'success') {
                        toast.classList.add('bg-green-600');
                        toast.innerHTML = `<span class="mr-2"><i class="fas fa-check-circle"></i></span> ${message}`;
                    } else if (type === 'error') {
                        toast.classList.add('bg-red-600');
                        toast.innerHTML = `<span class="mr-2"><i class="fas fa-exclamation-circle"></i></span> ${message}`;
                    } else {
                        toast.classList.add('bg-blue-600');
                        toast.innerHTML = `<span class="mr-2"><i class="fas fa-info-circle"></i></span> ${message}`;
                    }
                    
                    // Add to document
                    document.body.appendChild(toast);
                    
                    // Trigger animation
                    setTimeout(() => {
                        toast.classList.remove('translate-y-20', 'opacity-0');
                    }, 10);
                    
                    // Remove after delay
                    setTimeout(() => {
                        toast.classList.add('translate-y-20', 'opacity-0');
                        setTimeout(() => {
                            toast.remove();
                        }, 300);
                    }, 3000);
                }
                
                // Handle accept button in the request details view
                const acceptRequestBtn = document.getElementById('accept-request-btn');
                if (acceptRequestBtn) {
                    acceptRequestBtn.addEventListener('click', function() {
                        // Get the name of the selected request
                        const name = document.getElementById('request-detail-name').textContent;
                        
                        // Find the matching request item and click its accept button
                        const requestItems = document.querySelectorAll('.connection-request-item');
                        requestItems.forEach(item => {
                            const nameEl = item.querySelector('h3');
                            if (nameEl && nameEl.textContent === name) {
                                const acceptBtn = item.querySelector('button:first-of-type');
                                if (acceptBtn) {
                                    // Simulate a click on the accept button
                                    const clickEvent = new MouseEvent('click', {
                                        bubbles: true,
                                        cancelable: true,
                                        view: window
                                    });
                                    acceptBtn.dispatchEvent(clickEvent);
                                }
                            }
                        });
                        
                        // Update the request details view UI
                        this.textContent = 'Send Message';
                        this.nextElementSibling.textContent = 'View Profile';
                    });
                }
            }
            
            // Initialize the connection request feature
            initConnectionRequestFeature();
            
            // Handle conversation item clicks to show the associated chat
            const conversationItems = document.querySelectorAll('.conversation-item');
            conversationItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all conversation items
                    conversationItems.forEach(conv => {
                        conv.classList.remove('bg-blue-50');
                        conv.classList.remove('hover:bg-blue-100');
                        conv.classList.add('hover:bg-gray-50');
                    });
                    
                    // Add active class to clicked conversation
                    this.classList.add('bg-blue-50');
                    this.classList.add('hover:bg-blue-100');
                    this.classList.remove('hover:bg-gray-50');
                    
                    // Get the contact data attribute to determine which chat to show
                    const contactId = this.getAttribute('data-contact');
                    
                    // Hide all chat content
                    const chatContents = document.querySelectorAll('.chat-content');
                    chatContents.forEach(chat => {
                        chat.classList.add('hidden');
                        chat.classList.remove('active');
                    });
                    
                    // Show the appropriate chat content based on contact ID
                    const targetChat = document.getElementById(`chat-${contactId}`);
                    if (targetChat) {
                        targetChat.classList.remove('hidden');
                        targetChat.classList.add('active');
                        
                        // Scroll to the bottom of the chat
                        scrollToLatestMessage();
                        
                        // Update the conversation header with the contact's name and image
                        const contactName = this.querySelector('h3').textContent;
                        const isOnline = this.querySelector('.absolute.bottom-0.right-0.w-3.h-3.bg-green-500') !== null;
                        const contactImg = this.querySelector('img').src;
                        
                        // Use the updated function with image parameter
                        updateConversationHeader(contactName, isOnline, contactImg);
                        
                        // If the contact had unread messages, mark as read (remove the unread badge)
                        const unreadBadge = this.querySelector('.unread-badge');
                        if (unreadBadge) {
                            unreadBadge.style.display = 'none';
                        }
                    }
                });
            });
            
            // Make sure to integrate the above code within the DOMContentLoaded event listener
            initConversationItemHandlers();
            
            // Function to handle sending a new message
            function sendMessage() {
                const messageInput = document.getElementById('message-input');
                const messageText = messageInput.value.trim();
                
                if (messageText === '') return; // Don't send empty messages
                
                // Get the active chat content
                const activeChat = document.querySelector('.chat-content.active');
                if (!activeChat) return;
                
                // Create a new message element
                const messageElement = document.createElement('div');
                messageElement.className = 'flex items-end justify-end mb-5 message-bubble';
                
                // Get current time
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const timeString = `${hours}:${minutes}`;
                
                // Set message HTML
                messageElement.innerHTML = `
                    <span class="text-xs text-gray-500 mr-2">${timeString}</span>
                    <div class="max-w-xs bg-blue-600 text-white rounded-2xl rounded-br-none py-2.5 px-4 shadow-sm">
                        <p class="text-sm">${messageText}</p>
                    </div>
                `;
                
                // Add message to the active chat
                activeChat.appendChild(messageElement);
                
                // Clear input
                messageInput.value = '';
                
                // Focus back on input
                messageInput.focus();
                
                // Scroll to latest message
                scrollToLatestMessage();
            }

            // Add event listeners for message sending
            function initMessageSending() {
                const messageInput = document.getElementById('message-input');
                const sendButton = document.getElementById('send-message-btn');
                
                if (messageInput && sendButton) {
                    // Send on button click
                    sendButton.addEventListener('click', sendMessage);
                    
                    // Send on Enter key
                    messageInput.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            sendMessage();
                        }
                    });
                    
                    // Focus input when conversation is clicked
                    const conversationItems = document.querySelectorAll('.conversation-item');
                    conversationItems.forEach(item => {
                        item.addEventListener('click', function() {
                            setTimeout(() => {
                                messageInput.focus();
                            }, 100);
                        });
                    });
                }
            }

            // Initialize message sending functionality
            initMessageSending();
        });
        
        // Function to initialize conversation item handlers
        function initConversationItemHandlers() {
            const conversationItems = document.querySelectorAll('.conversation-item');
            conversationItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all conversation items
                    conversationItems.forEach(conv => {
                        conv.classList.remove('bg-blue-50');
                        conv.classList.remove('hover:bg-blue-100');
                        conv.classList.add('hover:bg-gray-50');
                    });
                    
                    // Add active class to clicked conversation
                    this.classList.add('bg-blue-50');
                    this.classList.add('hover:bg-blue-100');
                    this.classList.remove('hover:bg-gray-50');
                    
                    // Get the contact data attribute to determine which chat to show
                    const contactId = this.getAttribute('data-contact');
                    
                    // Hide all chat content
                    const chatContents = document.querySelectorAll('.chat-content');
                    chatContents.forEach(chat => {
                        chat.classList.add('hidden');
                        chat.classList.remove('active');
                    });
                    
                    // Show the appropriate chat content based on contact ID
                    const targetChat = document.getElementById(`chat-${contactId}`);
                    if (targetChat) {
                        targetChat.classList.remove('hidden');
                        targetChat.classList.add('active');
                        
                        // Scroll to the bottom of the chat
                        scrollToLatestMessage();
                        
                        // Update the conversation header with the contact's name and image
                        const contactName = this.querySelector('h3').textContent;
                        const isOnline = this.querySelector('.absolute.bottom-0.right-0.w-3.h-3.bg-green-500') !== null;
                        const contactImg = this.querySelector('img').src;
                        updateConversationHeader(contactName, isOnline, contactImg);
                        
                        // If the contact had unread messages, mark as read (remove the unread badge)
                        const unreadBadge = this.querySelector('.unread-badge');
                        if (unreadBadge) {
                            unreadBadge.style.display = 'none';
                        }
                    } else {
                        // If no specific chat content exists, show a default message or create dynamic content
                        const defaultChat = document.createElement('div');
                        defaultChat.id = `chat-${contactId}`;
                        defaultChat.className = 'chat-content active';
                        defaultChat.innerHTML = `
                            <div class="flex flex-col items-center justify-center h-full text-center text-gray-500 p-8">
                                <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4">
                                    <i class="fas fa-comment text-2xl text-gray-400"></i>
                                </div>
                                <h3 class="text-lg font-medium mb-2">Start a conversation</h3>
                                <p class="text-sm max-w-md">Send a message to ${this.querySelector('h3').textContent} to start the conversation.</p>
                            </div>
                        `;
                        
                        // Add the new chat content to the messages area
                        const messagesArea = document.querySelector('.messages-area');
                        messagesArea.appendChild(defaultChat);
                        
                        // Update the conversation header
                        const contactName = this.querySelector('h3').textContent;
                        const isOnline = this.querySelector('.absolute.bottom-0.right-0.w-3.h-3.bg-green-500') !== null;
                        const contactImg = this.querySelector('img').src;
                        updateConversationHeader(contactName, isOnline, contactImg);
                    }
                });
            });
            
            // Make sure the existing chat functionality still works by simulating a click on the active conversation
            const activeConversation = document.querySelector('.conversation-item.bg-blue-50');
            if (activeConversation) {
                activeConversation.click();
            } else {
                // Default to the first conversation if none is active
                const firstConversation = document.querySelector('.conversation-item');
                if (firstConversation) {
                    firstConversation.click();
                }
            }
        }
    </script>
</body>
</html> 
</html> 